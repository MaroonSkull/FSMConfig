# Git Workflow (Trunk-Based Development)

## Общий процесс

```
1. Кратко проанализировать задачу (режим orchestrator)
   ↓
2. Придумать название задачи
   ↓
3. Создать новую ветку для задачи
   ↓
4. Для отдельных подзадач создавать дополнительные ветки
   ↓
5. После завершения подзадачи — смерджить в рабочую ветку
```

## Создание веток

**Формат названия веток:**

```
feature/краткое-описание-задачи
bugfix/описание-бага
refactor/описание-рефакторинга
docs/описание-документации
```

**Примеры:**

```bash
git checkout -b feature/add-state-persistence
git checkout -b bugfix/fix-memory-leak-in-parser
git checkout -b refactor/optimize-event-dispatcher
```

## Коммиты

**Правила коммитов:**

1. **Частота:** Делать коммиты так часто, как только возможно
2. **История:** История коммитов должна быть богатой и информативной
3. **ПРАВИЛО:** Перед созданием коммита убедиться:
   - Код работает корректно ИЛИ
   - Код как минимум компилируется без ошибок

**Формат сообщения коммита:**

```
<тип>: <краткое описание>

<подробное описание (опционально)>

<ссылки на задачи (опционально)>
```

**Типы коммитов:**

- `feat` — новая функциональность
- `fix` — исправление бага
- `refactor` — рефакторинг
- `docs` — документация
- `test` — тесты
- `chore` — рутинные задачи

**Примеры:**

```
feat: добавить поддержку вложенных состояний

Реализована иерархическая структура состояний с наследованием.
Добавлены тесты в test_state_machine.cpp.

Closes #42
```

```
fix: исправить утечку памяти в ConfigParser

Проблема была в отсутствии освобождения YAML::Node.
Теперь используется умный указатель.
```

## Завершение задачи

```
1. Критический анализ git diff
   └─ Использовать режим review
   ↓
2. Проверка и актуализация документации
   ├─ Все затронутые места задокументированы?
   └─ AGENTS.md актуализирован для отражения текущего состояния проекта?
       │
       └─ **ВАЖНО:** Перед созданием коммита необходимо создать отдельную задачу
                   для актуализации соответствующих разделов AGENTS.md, если
                   выполненная работа затрагивает структуру проекта, технологии,
                   процессы разработки или другие аспекты, описанные в этом файле.
   ↓
3. Слияние веток
   └─ Смерджить все дополнительные ветки в основную рабочую
   ↓
4. Рабочую ветку никуда сливать не нужно
   └─ Её анализ выполнит программист
```

**Процесс review:**

```bash
# Показать все изменения
git diff main..feature/branch-name

# Интерактивный review
git review main..feature/branch-name
```
